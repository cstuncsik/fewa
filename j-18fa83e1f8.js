!function(){"use strict";var e={};!function(){for(var e=0,t=["webkit","moz","o","ms"],i=0;i<t.length&&!window.requestAnimationFrame;i+=1)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){var o=(new Date).getTime(),r=Math.max(0,16-(o-e)),n=window.setTimeout(function(){t(o+r)},r);return e=o+r,n})}(),function(){e.obj={extend:function(){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,i=function(i){if(!i||"[object Object]"!==t.call(i))return!1;var o=e.call(i,"constructor"),r=i.constructor&&i.constructor.prototype&&e.call(i.constructor.prototype,"isPrototypeOf");if(i.constructor&&!o&&!r)return!1;var n;for(n in i);return void 0===n||e.call(i,n)};return function o(){var e,t,r,n,s,a,c=arguments[0],l=1,h=arguments.length,u=!1;for("boolean"==typeof c?(u=c,c=arguments[1]||{},l=2):("object"!=typeof c&&"function"!=typeof c||null===c)&&(c={});h>l;++l)if(e=arguments[l],null!==e)for(t in e)r=c[t],n=e[t],c!==n&&(u&&n&&(i(n)||(s=Array.isArray(n)))?(s?(s=!1,a=r&&Array.isArray(r)?r:[]):a=r&&i(r)?r:{},c[t]=o(u,a,n)):void 0!==n&&(c[t]=n));return c}}()},e.obj.extend(!0,e,{vendor:{prefixes:["","ms","webkit","moz","o"],get:function(e){var t,i;for(i=0;i<this.prefixes.length;i++)if(t=this.prefixes[i]+(""===this.prefixes[i]?e:e.charAt(0).toUpperCase()+e.slice(1)),"undefined"!=typeof document.body.style[t])return t;return null}},dom:{get:function(e){return document.getElementById(e)},create:function(e){return document.createElement(e)}},arr:{create:function(e,t){for(var i,o=[],r=0;e>r;r+=1)i="undefined"==typeof t?[]:t,o.push(i);return o},move:function(e,t,i){e[t]=e.splice(i,1,e[t])[0]},loop:function(e,t,i){for(var o=e.length,r=0;o>r;r+=1)t.call(i||null,e[r],r)}},rand:{intg:function(e){return Math.random()*(e||268435455)|0},flot:function(){return Math.random()},bool:function(){return Math.random()>.5},range:function(t,i){return e.rand.intg(i-t)+t},rangef:function(t,i){return e.rand.flot()*(i-t)+t},select:function(t){return t[e.rand.range(0,t.length)]}},PI2:2*Math.PI,RAD:Math.PI/180,DEG:180/Math.PI,noop:function(){},line:function(e,t,i,o,r,n,s){e.strokeStyle=n,e.lineWidth=s,e.beginPath(),e.moveTo(t,i),e.lineTo(o,r),e.stroke()},rect:function(t,i,o,r,n,s,a,c,l,h){i+=c,r-=2*c,o+=c,n-=2*c,t.beginPath(),t.strokeStyle=a,t.lineWidth=c,t.moveTo(i+s,o),t.lineTo(i+r-s,o),t.quadraticCurveTo(i+r,o,i+r,o+s),t.lineTo(i+r,o+n-s),t.quadraticCurveTo(i+r,o+n,i+r-s,o+n),t.lineTo(i+s,o+n),t.quadraticCurveTo(i,o+n,i,o+n-s),t.lineTo(i,o+s),t.quadraticCurveTo(i,o,i+s,o),t.closePath(),t.stroke(),l&&(t.fillStyle=l,t.fill()),h&&e.rect(t,i-c,o-c,r+2*c,n+2*c,1.2*s,h,c/2)},sine:function(e,t,i,o,r,n,s){var a=(t+o)/2,c=(i+r)/2;e.strokeStyle=n,e.lineWidth=s,e.beginPath(),e.moveTo(t,i),e.bezierCurveTo(t,i,a/2,1.5*c,a,c),e.bezierCurveTo(1.5*a,c/2,o,r,o,r),e.stroke()}})}(),function(){e.obj.extend(!0,e,{columns:8,gap:2,speed:.1,gravity:.3,moveBg:!0,rumble:{decay:.4},starAmount:Math.floor(window.innerWidth/window.innerHeight*100),starColors:["#ffffff","#ffe9c4","#d4fbff"],elements:{FIRE:{color:"#ff3824",latency:50,against:{FIRE:20,EARTH:2,WATER:1,AIR:5},bricks:{empty:{energy:10},filled:{energy:20},special:{energy:40}},desc:"The Fire element, most effective against fire bricks, but least effective against water bricks.",spec:"Fire special brick explodes the whole column of bricks."},EARTH:{color:"#44db5e",latency:80,against:{FIRE:5,EARTH:20,WATER:2,AIR:1},bricks:{empty:{energy:10},filled:{energy:20},special:{energy:40}},desc:"The Earth element, most effective against earth bricks, but least effective against air bricks.",spec:"Earth special brick explodes surrounding bricks."},WATER:{color:"#54c7fc",latency:70,against:{FIRE:1,EARTH:2,WATER:20,AIR:5},bricks:{empty:{energy:10},filled:{energy:20},special:{energy:40}},desc:"The Water element, most effective against water bricks, but least effective against fire bricks.",spec:"Water special brick explodes the whole row of bricks."},AIR:{color:"#ffcd00",latency:60,against:{FIRE:5,EARTH:1,WATER:2,AIR:20},bricks:{empty:{energy:10},filled:{energy:20},special:{energy:40}},desc:"The Air element, most effective against air bricks, but least effective against earth bricks.",spec:"Air special brick explodes all the weak(stroked) air bricks."}}})}(),function(){e.sprite={items:{},create:function(e,t,i,o){if(!this.get(e)){var r=document.createElement("canvas");r.width=t,r.height=i;var n=r.getContext("2d");n.save(),o(n),n.restore(),this.set(e,r)}return this.get(e)},set:function(e,t){this.items[e]=t},get:function(e){return this.items[e]},factory:function(){var t=e.brickWidth/10,i=e.brickWidth/2,o=e.brickHeight/2,r=e.brickWidth/10,n=t,s="rgba(255,255,255,0.8)",a="rgba(255,255,0,0.5)";this.create("AIR",e.brickWidth,e.brickWidth,function(t){var i=(e.brickWidth-2*r)/4;e.rect(t,0,0,e.brickWidth,e.brickWidth,n,e.elements.AIR.color,r,null,s),t.lineWidth=r,t.strokeStyle=e.elements.AIR.color,t.translate(r,0);for(var o=0;3>o;o++)t.beginPath(),t.moveTo(i,r),t.lineTo(i,e.brickWidth-r),t.stroke(),t.translate(i,0)}),this.create("AIR-SHOT",e.brickWidth,e.brickHeight,function(o){e.rect(o,i-t,0,2*t,e.brickHeight,2,e.elements.AIR.color,r,e.elements.AIR.color,a)}),this.create("AIR-BRICK-empty",e.brickWidth,e.brickHeight,function(t){e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.AIR.color,r,null,s)}),this.create("AIR-BRICK-filled",e.brickWidth,e.brickHeight,function(t){e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.AIR.color,r,e.elements.AIR.color,s)}),this.create("AIR-BRICK-special",e.brickWidth,e.brickHeight,function(t){t.fillStyle=e.elements.AIR.color,t.fillRect(i-o/2,r,o,e.brickHeight-2*r),e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.AIR.color,r,null,s)}),this.create("EARTH",e.brickWidth,e.brickWidth,function(t){var i=(e.brickWidth-2*r)/4;e.rect(t,0,0,e.brickWidth,e.brickWidth,n,e.elements.EARTH.color,r,null,s),t.lineWidth=r,t.strokeStyle=e.elements.EARTH.color,t.translate(0,r);for(var o=0;3>o;o++)t.beginPath(),t.moveTo(r,i),t.lineTo(e.brickWidth-r,i),t.stroke(),t.translate(0,i)}),this.create("EARTH-SHOT",e.brickWidth,e.brickHeight,function(o){e.rect(o,i-t,0,2*t,e.brickHeight,2,e.elements.EARTH.color,r,e.elements.EARTH.color,a)}),this.create("EARTH-BRICK-empty",e.brickWidth,e.brickHeight,function(t){e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.EARTH.color,r,null,s)}),this.create("EARTH-BRICK-filled",e.brickWidth,e.brickHeight,function(t){e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.EARTH.color,r,e.elements.EARTH.color,s)}),this.create("EARTH-BRICK-special",e.brickWidth,e.brickHeight,function(t){t.fillStyle=e.elements.EARTH.color,t.fillRect(i-o/2,r,o,e.brickHeight-2*r),e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.EARTH.color,r,null,s)}),this.create("WATER",e.brickWidth,e.brickWidth,function(t){var i=(e.brickWidth-2*r)/4;e.rect(t,0,0,e.brickWidth,e.brickWidth,n,e.elements.WATER.color,r,null,s),t.lineWidth=r,t.strokeStyle=e.elements.WATER.color,t.translate(0,r);for(var o=0;3>o;o++)e.sine(t,r,i,e.brickWidth-r,i),t.translate(0,i)}),this.create("WATER-SHOT",e.brickWidth,e.brickHeight,function(o){e.rect(o,i-t,0,2*t,e.brickHeight,2,e.elements.WATER.color,r,e.elements.WATER.color,a)}),this.create("WATER-BRICK-empty",e.brickWidth,e.brickHeight,function(t){e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.WATER.color,r,null,s)}),this.create("WATER-BRICK-filled",e.brickWidth,e.brickHeight,function(t){e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.WATER.color,r,e.elements.WATER.color,s)}),this.create("WATER-BRICK-special",e.brickWidth,e.brickHeight,function(t){e.line(t,2*r,o,e.brickWidth-2*r,o,e.elements.WATER.color,r),e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.WATER.color,r,null,s)}),this.create("FIRE",e.brickWidth,e.brickWidth,function(t){var i=(e.brickWidth-2*r)/4;e.rect(t,0,0,e.brickWidth,e.brickWidth,n,e.elements.FIRE.color,r,null,s),t.lineWidth=r,t.strokeStyle=e.elements.FIRE.color,t.translate(-r,0),t.translate(e.brickWidth/2,e.brickWidth/2),t.rotate(90*e.RAD),t.translate(-e.brickWidth/2,-e.brickWidth/2);for(var o=0;3>o;o++)e.sine(t,r,i,e.brickWidth-r,i),t.translate(0,i)}),this.create("FIRE-SHOT",e.brickWidth,e.brickHeight,function(o){e.rect(o,i-t,0,2*t,e.brickHeight,2,e.elements.FIRE.color,r,e.elements.FIRE.color,a)}),this.create("FIRE-BRICK-empty",e.brickWidth,e.brickHeight,function(t){e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.FIRE.color,r,null,s)}),this.create("FIRE-BRICK-filled",e.brickWidth,e.brickHeight,function(t){e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.FIRE.color,r,e.elements.FIRE.color,s)}),this.create("FIRE-BRICK-special",e.brickWidth,e.brickHeight,function(t){e.line(t,i,2*r,i,e.brickHeight-2*r,e.elements.FIRE.color,r),e.rect(t,0,0,e.brickWidth,e.brickHeight,n,e.elements.FIRE.color,r,null,s)}),["#ffffff","#ed8500","#ffff00"].forEach(function(t){this.create("explosion"+t,e.brickWidth,e.brickHeight,function(i){e.rect(i,0,0,e.brickWidth,e.brickHeight,0,t,0,t)})},this)}}}(),function(){function e(){this.setSettings=function(e){for(var t=0;24>t;t++)this[String.fromCharCode(97+t)]=e[t]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(.18>i){var o=.18/i;this.b*=o,this.c*=o,this.e*=o}}}function t(){this._params=new e;var t,i,o,r,n,s,a,c,l,h,u,f;this.reset=function(){var e=this._params;r=100/(e.f*e.f+.001),n=100/(e.g*e.g+.001),s=1-e.h*e.h*e.h*.01,a=-e.i*e.i*e.i*1e-6,e.a||(u=.5-e.n/2,f=5e-5*-e.o),c=1+e.l*e.l*(e.l>0?-.9:10),l=0,h=1==e.m?0:(1-e.m)*(1-e.m)*2e4+32},this.totalReset=function(){this.reset();var e=this._params;return t=e.b*e.b*1e5,i=e.c*e.c*1e5,o=e.e*e.e*1e5+12,3*((t+i+o)/3|0)},this.synthWave=function(e,d){var m=this._params,p=1!=m.s||m.v,v=m.v*m.v*.1,g=1+3e-4*m.w,b=m.s*m.s*m.s*.1,y=1+1e-4*m.t,w=1!=m.s,_=m.x*m.x,x=m.g,k=m.q||m.r,A=m.r*m.r*m.r*.2,W=m.q*m.q*(m.q<0?-1020:1020),R=m.p?((1-m.p)*(1-m.p)*2e4|0)+32:0,T=m.d,E=m.j/2,C=m.k*m.k*.01,H=m.a,I=t,q=1/t,S=1/i,M=1/o,B=5/(1+m.u*m.u*20)*(.01+b);B>.8&&(B=.8),B=1-B;for(var D,F,L,G,P,j,O=!1,K=0,z=0,U=0,N=0,V=0,X=0,J=0,Q=0,Y=0,Z=0,$=new Array(1024),ee=new Array(32),te=$.length;te--;)$[te]=0;for(var te=ee.length;te--;)ee[te]=2*Math.random()-1;for(var te=0;d>te;te++){if(O)return te;if(R&&++Y>=R&&(Y=0,this.reset()),h&&++l>=h&&(h=0,r*=c),s+=a,r*=s,r>n&&(r=n,x>0&&(O=!0)),F=r,E>0&&(Z+=C,F*=1+Math.sin(Z)*E),F|=0,8>F&&(F=8),H||(u+=f,0>u?u=0:u>.5&&(u=.5)),++z>I)switch(z=0,++K){case 1:I=i;break;case 2:I=o}switch(K){case 0:U=z*q;break;case 1:U=1+2*(1-z*S)*T;break;case 2:U=1-z*M;break;case 3:U=0,O=!0}k&&(W+=A,L=0|W,0>L?L=-L:L>1023&&(L=1023)),p&&g&&(v*=g,1e-5>v?v=1e-5:v>.1&&(v=.1)),j=0;for(var ie=8;ie--;){if(J++,J>=F&&(J%=F,3==H))for(var oe=ee.length;oe--;)ee[oe]=2*Math.random()-1;switch(H){case 0:P=u>J/F?.5:-.5;break;case 1:P=1-J/F*2;break;case 2:G=J/F,G=6.28318531*(G>.5?G-1:G),P=1.27323954*G+.405284735*G*G*(0>G?1:-1),P=.225*((0>P?-1:1)*P*P-P)+P;break;case 3:P=ee[Math.abs(32*J/F|0)]}p&&(D=X,b*=y,0>b?b=0:b>.1&&(b=.1),w?(V+=(P-X)*b,V*=B):(X=P,V=0),X+=V,N+=X-D,N*=1-v,P=N),k&&($[Q%1024]=P,P+=$[(Q-L+1024)%1024],Q++),j+=P}j*=.125*U*_,e[te]=j>=1?32767:-1>=j?-32768:32767*j|0}return d}}var i=new t;window.jsfxr=function(e){i._params.setSettings(e);var t=i.totalReset(),o=new Uint8Array(4*((t+1)/2|0)+44),r=2*i.synthWave(new Uint16Array(o.buffer,44),t),n=new Uint32Array(o.buffer,0,44);n[0]=1179011410,n[1]=r+36,n[2]=1163280727,n[3]=544501094,n[4]=16,n[5]=65537,n[6]=44100,n[7]=88200,n[8]=1048578,n[9]=1635017060,n[10]=r,r+=44;for(var s=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="data:audio/wav;base64,";r>s;s+=3){var l=o[s]<<16|o[s+1]<<8|o[s+2];c+=a[l>>18]+a[l>>12&63]+a[l>>6&63]+a[63&l]}return c}}();var t;!function(){function e(e){return Math.sin(6.283184*e)}function i(t){return e(t)<0?-1:1}function o(e){return e%1-.5}function r(e){var t=e%1*4;return 2>t?t-1:3-t}function n(e){return.00390625*Math.pow(1.059463094,e-128)}function s(e,t){setTimeout(function(){var i=new Uint8Array(e*l*2),o=i.length-2,r=function(){for(var e=new Date,n=0;o>=0;)if(i[o]=0,i[o+1]=128,o-=2,n+=1,n%1e3===0&&new Date-e>h)return void setTimeout(r,0);setTimeout(function(){t(i)},0)};setTimeout(r,0)},0)}function a(e,t,i,o,r){var n=i.fx_delay_time*o>>1,s=i.fx_delay_amt/255,a=0,c=function(){for(var i=new Date,o=0;t-n>a;){var l=4*a,u=4*(a+n),f=e[u]+(e[u+1]<<8)+(e[l+2]+(e[l+3]<<8)-32768)*s;if(e[u]=255&f,e[u+1]=f>>8&255,f=e[u+2]+(e[u+3]<<8)+(e[l]+(e[l+1]<<8)-32768)*s,e[u+2]=255&f,e[u+3]=f>>8&255,++a,o+=1,o%1e3===0&&new Date-i>h)return void setTimeout(c,0)}setTimeout(r,0)};setTimeout(c,0)}t={};var c=44100,l=2,h=33,u=null,f=[e,i,o,r];t.AudioGenerator=function(e){this.mixBuf=e,this.waveSize=e.length/l/2},t.AudioGenerator.prototype.getWave=function(){var e,t,i,o,r,n,s,a=this.mixBuf,c=this.waveSize,h=c*l*2;for(r=h-8,n=r-36,o=String.fromCharCode(82,73,70,70,255&r,r>>8&255,r>>16&255,r>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&n,n>>8&255,n>>16&255,n>>24&255),e=0;h>e;){for(i="",t=0;256>t&&h>e;++t,e+=2)s=4*(a[e]+(a[e+1]<<8)-32768),s=-32768>s?-32768:s>32767?32767:s,i+=String.fromCharCode(255&s,s>>8&255);o+=i}return o},t.AudioGenerator.prototype.getAudio=function(){var e=this.getWave(),t=new Audio("data:audio/wav;base64,"+btoa(e));return t.preload="none",t.load(),t},t.AudioGenerator.prototype.getAudioBuffer=function(e){null===u&&(u=new AudioContext);var t=this.mixBuf,i=this.waveSize,o=u.createBuffer(l,this.waveSize,c),r=o.getChannelData(0),n=o.getChannelData(1),s=0,a=function(){for(var c=new Date,l=0;i>s;){var u=4*(t[4*s]+(t[4*s+1]<<8)-32768);if(u=-32768>u?-32768:u>32767?32767:u,r[s]=u/32768,u=4*(t[4*s+2]+(t[4*s+3]<<8)-32768),u=-32768>u?-32768:u>32767?32767:u,n[s]=u/32768,s+=1,l+=1,l%1e3===0&&new Date-c>h)return void setTimeout(a,0)}setTimeout(function(){e(o)},0)};setTimeout(a,0)},t.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=f[e.lfo_waveform],this.osc1=f[e.osc1_waveform],this.osc2=f[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},t.SoundGenerator.prototype.genSound=function(t,i,o){for(var r=(new Date,0),s=0,a=n(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),l=n(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),h=this.instr.fx_resonance/255,u=0,f=0,d=this.attack+this.sustain+this.release-1;d>=0;--d){var m=d+o,p=this.osc_lfo(m*this.lfoFreq)*this.instr.lfo_amt/512+.5,v=1;d<this.attack?v=d/this.attack:d>=this.attack+this.sustain&&(v-=(d-this.attack-this.sustain)/this.release);var g=a;this.instr.lfo_osc1_freq&&(g+=p),this.instr.osc1_xenv&&(g*=v*v),r+=g;var b=this.osc1(r)*this.instr.osc1_vol;g=l,this.instr.osc2_xenv&&(g*=v*v),s+=g,b+=this.osc2(s)*this.instr.osc2_vol,this.instr.noise_fader&&(b+=(2*Math.random()-1)*this.instr.noise_fader*v),b*=v/255;var y=this.instr.fx_freq;this.instr.lfo_fx_freq&&(y*=p),y=1.5*Math.sin(3.141592*y/c),u+=y*f;var w=h*(b-f)-u;switch(f+=y*w,this.instr.fx_filter){case 1:b=w;break;case 2:b=u;break;case 3:b=f;break;case 4:b=u+w}if(g=e(m*this.panFreq)*this.instr.fx_pan_amt/512+.5,b*=39*this.instr.env_master,m=4*m,m+3<i.length){var _=i[m]+(i[m+1]<<8)+b*(1-g);i[m]=255&_,i[m+1]=_>>8&255,_=i[m+2]+(i[m+3]<<8)+b*g,i[m+2]=255&_,i[m+3]=_>>8&255}}},t.SoundGenerator.prototype.getAudioGenerator=function(e,i){var o=this.attack+this.sustain+this.release-1+32*this.rowLen,r=this;s(o,function(n){r.genSound(e,n,0),a(n,o,r.instr,r.rowLen,function(){i(new t.AudioGenerator(n))})})},t.SoundGenerator.prototype.createAudio=function(e,t){this.getAudioGenerator(e,function(e){t(e.getAudio())})},t.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},t.MusicGenerator=function(e){this.song=e,this.waveSize=c*e.songLen},t.MusicGenerator.prototype.generateTrack=function(e,i,o){var r=this;s(this.waveSize,function(n){var s=r.waveSize,c=r.waveSize*l*2,u=r.song.rowLen,f=r.song.endPattern,d=new t.SoundGenerator(e,u),m=0,p=0,v=0,g=function(){for(var t=new Date;;)if(32!==v){if(p===f-1)return void setTimeout(b,0);var i=e.p[p];if(i){var o=e.c[i-1].n[v];o&&d.genSound(o,n,m)}if(m+=u,v+=1,new Date-t>h)return void setTimeout(g,0)}else v=0,p+=1},b=function(){a(n,s,e,u,w)},y=0,w=function(){for(var e=new Date,t=0;c>y;){var r=i[y]+(i[y+1]<<8)+n[y]+(n[y+1]<<8)-32768;if(i[y]=255&r,i[y+1]=r>>8&255,y+=2,t+=1,t%1e3===0&&new Date-e>h)return void setTimeout(w,0)}setTimeout(o,0)};setTimeout(g,0)})},t.MusicGenerator.prototype.getAudioGenerator=function(e){var i=this;s(this.waveSize,function(o){var r=0,n=function(){r<i.song.songData.length?(r+=1,i.generateTrack(i.song.songData[r-1],o,n)):e(new t.AudioGenerator(o))};n()})},t.MusicGenerator.prototype.createAudio=function(e){this.getAudioGenerator(function(t){e(t.getAudio())})},t.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})}}(),function(){window.song={songLen:145,songData:[{osc1_oct:9,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:161,osc1_waveform:0,osc2_oct:9,osc2_det:0,osc2_detune:4,osc2_xenv:0,osc2_vol:182,osc2_waveform:0,noise_fader:0,env_attack:100,env_sustain:1818,env_release:18181,env_master:192,fx_filter:0,fx_freq:0,fx_resonance:254,fx_delay_time:6,fx_delay_amt:108,fx_pan_freq:3,fx_pan_amt:61,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:3,lfo_amt:94,lfo_waveform:2,p:[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,0,2,3,4,1,2,3,4,5,6,7,8,5],c:[{n:[142,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,140,0,0,0,0,0,0,0,138,0,0,0,0,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,135,0,0,0,138,0,0,0]},{n:[140,0,138,0,135,0,0,0,0,0,0,0,0,0,130,0,142,0,140,0,135,0,0,0,0,0,0,0,138,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,130,0,142,0,0,0,0,0,0,0,135,0,0,0,138,0,0,0]},{n:[123,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[119,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:19,env_attack:100,env_sustain:0,env_release:3636,env_master:192,fx_filter:1,fx_freq:8100,fx_resonance:156,fx_delay_time:2,fx_delay_amt:22,fx_pan_freq:3,fx_pan_amt:43,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[0,0,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[135,0,135,0,0,135,0,135,135,0,135,0,0,135,0,135,135,0,135,0,0,135,0,135,135,0,135,0,0,135,0,135]},{n:[135,0,135,0,0,135,0,135,135,0,135,0,0,135,0,135,135,0,135,0,0,135,0,135,135,0,135,0,135,0,135,135]}]},{osc1_oct:6,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:8,osc2_det:0,osc2_detune:8,osc2_xenv:0,osc2_vol:82,osc2_waveform:2,noise_fader:0,env_attack:100,env_sustain:4545,env_release:2727,env_master:192,fx_filter:3,fx_freq:2700,fx_resonance:85,fx_delay_time:6,fx_delay_amt:60,fx_pan_freq:6,fx_pan_amt:86,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:7,lfo_amt:106,lfo_waveform:0,p:[0,0,0,0,1,1,2,3,1,1,2,3,1,1,2,3,1,1,2,3,1,1,2,3],c:[{n:[135,135,147,135,0,135,147,135,135,135,147,135,0,135,147,135,135,135,147,135,0,135,147,135,135,135,147,135,0,135,147,135]},{n:[140,140,152,140,0,140,152,140,140,140,152,140,0,140,152,140,140,140,152,140,0,140,152,140,140,140,152,140,0,140,152,142]},{n:[131,131,143,131,0,131,143,131,131,131,143,131,0,131,143,131,138,138,150,138,0,138,150,138,138,138,150,138,0,138,150,137]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:187,osc1_waveform:2,osc2_oct:5,osc2_det:0,osc2_detune:2,osc2_xenv:1,osc2_vol:161,osc2_waveform:2,noise_fader:0,env_attack:100,env_sustain:1818,env_release:2727,env_master:123,fx_filter:1,fx_freq:1900,fx_resonance:162,fx_delay_time:2,fx_delay_amt:153,fx_pan_freq:6,fx_pan_amt:61,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:2,lfo_amt:196,lfo_waveform:3,p:[0,0,0,0,0,0,0,0,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,3],c:[{n:[135,135,138,135,142,135,140,138,135,135,138,135,142,135,140,138,135,135,138,135,142,135,140,138,135,135,138,135,142,135,140,138]},{n:[143,143,155,143,0,143,155,143,143,143,150,143,147,143,140,143,138,138,143,138,143,140,138,140,138,138,143,138,142,140,138,140]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:70,osc2_waveform:2,noise_fader:8,env_attack:100,env_sustain:0,env_release:9090,env_master:164,fx_filter:2,fx_freq:5500,fx_resonance:240,fx_delay_time:6,fx_delay_amt:51,fx_pan_freq:3,fx_pan_amt:66,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[135,0,0,0,0,0,135,0,0,0,135,0,0,0,0,0,135,0,0,0,0,0,135,0,0,0,135,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:6,osc2_xenv:0,osc2_vol:184,osc2_waveform:2,noise_fader:21,env_attack:4e4,env_sustain:25454,env_release:90909,env_master:77,fx_filter:2,fx_freq:7100,fx_resonance:188,fx_delay_time:8,fx_delay_amt:147,fx_pan_freq:4,fx_pan_amt:69,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:7,lfo_amt:176,lfo_waveform:1,p:[0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,5],c:[{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[142,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[143,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],rowLen:6615,endPattern:30}}(),function(){e.fx={click:{count:4,params:[[2,,.06,,.61,.58,,.0092,-.0248,.0059,.9077,-1,-.855,,-1,,-.24,-.4599,.9991,-.647,-.5371,,-1,.33]]},hover:{count:4,params:[[2,.46,.01,.0058,,.29,,-.06,-.02,,,-.7,.5,,-1,,-.5125,-.2453,.4399,-.7,,.0058,-1,.51]]},select:{count:4,params:[[2,,.0138,,.86,.52,,.04,-.04,,,-1,,,-1,,-1,-.56,.63,-.4,.35,,-1,.16]]},move:{count:4,params:[[2,.18,.01,,.3702,.14,,-.0799,.26,.41,.67,-1,,,-1,,-.1999,-.3199,.46,-.0799,,,-1,.4]]},hit:{count:18,params:[[2,.16,.18,,,.4,,-.3199,-.4399,,,-1,,,-1,,-1,-1,.74,-1,,.54,-1,.55]]},explosion:{count:4,params:[[3,,.11,.81,.4543,.11,,-1,-1,,,.36,.21,.45,-.6599,,-.04,.72,.26,-.4399,,,-.64,.34]]},explosionBig:{count:4,params:[[3,,.87,,,.22,,,-.14,,,-1,,,-1,,.08,-.28,.44,-.3399,,,-1,.17]]},levelup:{count:1,params:[[3,.0061,.1462,.0048,.9138,.5027,,.065,,,.6737,.1527,,,-.9567,,.081,-.0307,.071,.0945,,2e-4,,.26]]},death:{count:1,params:[[0,1e-4,.7618,.1376,.81,.1,,.3358,3e-4,,,.3006,,,.048,.6803,-1,-.76,.9985,.6463,.3453,,-1,.27]]}},e.audio={sounds:{},references:[],mute:!1,play:function(t){if(!e.audio.mute){var i=e.audio.sounds[t];i=i.length>1?e.audio.sounds[t][e.rand.range(0,i.length)]:e.audio.sounds[t][0],i.pool[i.tick].play(),i.tick<i.count-1?i.tick++:i.tick=0}}};for(var t in e.fx)e.fx.hasOwnProperty(t)&&(e.audio.sounds[t]=[],e.fx[t].params.forEach(function(i,o){e.audio.sounds[t].push({tick:0,count:e.fx[t].count,pool:[]});for(var r=0;r<e.fx[t].count;r++){var n=new Audio;"undefined"!=typeof jsfxr&&(n.src=jsfxr(i)),e.audio.references.push(n),e.audio.sounds[t][o].pool.push(n)}}))}(),function(){e.entity=function(t){this.x=t.x||0,this.y=t.y||0,this.w=t.w||0,this.h=t.h||0,this.col=t.col||0,this.name=t.name||"",this.removed=!1,this.sprite=e.sprite.create(this.name,this.w,this.h,function(e){e.fillStyle=this.col,e.fillRect(0,0,this.w,this.h)}.bind(this))},e.entity.prototype.destroy=function(){this.removed=!0},e.entity.prototype.draw=function(){e.ctx.translate(this.x,this.y),this.rotate&&e.ctx.rotate(this.rotate*e.RAD),e.ctx.drawImage(this.sprite,-this.w/2,-this.h/2,this.w,this.h)}}(),function(){e.particle=function(t){e.entity.apply(this,arguments),this.dir=e.rand.bool()?-1:1,this.vx=5*Math.random()-2,this.vy=-10*Math.random()-1,this.move=t.speed+e.rand.rangef(-.5,.5),this.distance=0,this.maxDistance=(t.dist||200)+e.rand.range(-30,30),this.delta=this.w/this.maxDistance},e.particle.prototype=Object.create(e.entity.prototype),e.particle.prototype.constructor=e.particle,e.particle.prototype.update=function(){this.w-=this.delta,this.h-=this.delta,this.vy+=e.gravity,this.y+=this.vy,this.x+=this.vx,this.distance+=Math.sqrt(Math.pow(this.vx,2)+Math.pow(this.vy,2)),this.distance>this.maxDistance&&(this.distance=this.maxDistance,this.destroy())},e.particle.prototype.draw=function(){e.ctx.save(),e.ctx.globalAlpha=1-this.distance/this.maxDistance,e.entity.prototype.draw.call(this),e.ctx.restore()}}(),function(){e.explosion=function(t){e.entity.apply(this,arguments),this.distance=0,this.rotate=e.rand.range(0,360),this.rot=t.rot||e.rand.range(-5,5),this.delta=t.delta||.1,this.maxDistance=e.rand.range(8*this.delta,15*this.delta)},e.explosion.prototype=Object.create(e.entity.prototype),e.explosion.prototype.constructor=e.explosion,e.explosion.prototype.update=function(){this.distance+=this.delta,this.w+=this.delta,this.h+=this.delta,this.rotate+=this.rot,this.distance>this.maxDistance&&(this.distance=this.maxDistance,this.destroy())},e.explosion.prototype.draw=function(){e.ctx.save(),e.ctx.globalAlpha=1-this.distance/this.maxDistance,e.entity.prototype.draw.call(this),e.ctx.restore()}}(),function(){e.bullet=function(t){this.column=t.column,this.type=t.type,this.speed=5,this.width=e.brickWidth,this.height=e.brickHeight,this.x=this.column*this.width+e.gap*(this.column+1),this.y=e.stage.height-e.brickWidth,this.hw=this.width/2,this.hh=this.height/2,this.rad=1,this.removed=!1,this.power=100,this.sprite=e.sprite.get(this.type+"-SHOT")},e.bullet.prototype.destroy=function(){Array.prototype.push.apply(e.explosions,[new e.explosion({name:"explosion#ffffff",x:this.x+this.hw,y:this.y,w:this.power/4,h:this.power/4,col:"#ffffff",delta:2,rot:0}),new e.explosion({name:"explosion#ed8500",x:this.x+this.hw,y:this.y,w:this.power/7,h:this.power/7,col:"#ed8500",delta:1.5,rot:-5}),new e.explosion({name:"explosion#ffff00",x:this.x+this.hw,y:this.y,w:this.power/8,h:this.power/8,col:"#ffff00",delta:1,rot:4})]),this.removed=!0},e.bullet.prototype.update=function(){this.y-=this.speed*e.timer.delta,e.arr.loop(e.bricks[this.column],function(t,i){null!==t&&t.y>this.y-e.brickHeight&&(this.power=e.elements[this.type].against[t.type],this.type===t.type&&(e.rumble.level=1),t.hit(this.power,this.type),this.destroy())},this)},e.bullet.prototype.draw=function(){e.ctx.save(),e.ctx.translate(this.x,this.y),e.ctx.drawImage(this.sprite,0,0),e.ctx.restore()}}(),function(){e.tower=function(t){this.type=t.type,this.w=e.brickWidth,this.h=e.brickWidth,this.setColumn(t.column),this.y=e.stage.height-this.h,this.col=e.elements[this.type].color,this.hw=this.w/2,this.hh=this.h/2,this.rad=Math.round(this.w/10),this.removed=!1,this.sprite=e.sprite.get(this.type),this.shootDelay=this.latency=e.elements[this.type].latency},e.tower.prototype.setColumn=function(t){this.column=t,this.x=this.column*this.w+e.gap*(this.column+1)},e.tower.prototype.destroy=function(){this.removed=!0;var t,i,o=this.w/6,r=this.h/6;for(e.rumble.level=10,t=1;6>t;t++)for(i=1;6>i;i++)e.particles.push(new e.particle({name:"particle"+this.col,x:this.x+t*o,y:this.y+i*r,w:o,h:r,col:this.col,speed:e.rand.range(1,5),dist:100*e.rand.range(3,5)}));e.audio.play("explosion")},e.tower.prototype.shoot=function(){0!==e.s&&e.bullets.push(new e.bullet({column:this.column,type:this.type}))},e.tower.prototype.update=function(){this.shootDelay-=e.timer.delta,this.shootDelay<0&&(this.shoot(),this.shootDelay=this.latency)},e.tower.prototype.draw=function(){e.ctx.save(),e.ctx.translate(this.x,this.y),e.ctx.drawImage(this.sprite,0,0),e.ctx.restore()}}(),function(){e.brick=function(t){if(this.column=t.column,this.type=t.type,this.w=e.brickWidth,this.h=e.brickHeight,this.x=this.column*this.w+e.gap*(this.column+1),this.y=-this.h,this.hw=this.w/2,this.hh=this.h/2,this.rad=Math.round(this.w/10),this.removed=!1,this.col=e.elements[this.type].color,this.add=0,this.explode=e.noop,this.sprite=e.sprite.get(this.type+"-BRICK-"+t.item),this.val=this.energy=e.elements[this.type].bricks[t.item].energy,"special"===t.item)switch(t.type){case"FIRE":this.explode=function(){e.rumble.level=10,e.arr.loop(e.bricks[this.column],function(e,t){e&&!e.removed&&(e.hitType=e.type,e.destroy())}),e.audio.play("explosionBig")};break;case"EARTH":this.explode=function(){e.rumble.level=10;for(var t=0,i=e.columns;i>t;t+=1)e.arr.loop(e.bricks[t],function(e,t){e&&!e.removed&&e.row>=this.row-1&&e.row<=this.row+1&&e.column>=this.column-1&&e.column<=this.column+1&&(e.hitType=e.type,e.destroy())},this);e.audio.play("explosionBig")};break;case"WATER":this.explode=function(){e.rumble.level=10;for(var t=0,i=e.columns;i>t;t+=1)t!==this.column&&e.arr.loop(e.bricks[t],function(e,t){e&&!e.removed&&e.row===this.row&&(e.hitType=e.type,e.destroy())},this);e.audio.play("explosionBig")};break;case"AIR":this.explode=function(){e.rumble.level=10;for(var t=0,i=e.columns;i>t;t+=1)e.arr.loop(e.bricks[t],function(e,t){e&&!e.removed&&e.type===this.type&&(e.hitType=e.type,e.destroy())},this);e.audio.play("explosionBig")}}},e.brick.prototype.destroy=function(t){this.removed=!0,this.type===this.hitType&&(this.explode(),e.flash=8),e.rumble.level=5;for(var i=12,o=0,r=10;r>o;o+=1)e.particles.push(new e.particle({name:"particle"+this.col,x:this.x+this.w/2,y:this.y+this.h,w:this.w/i,h:this.h/(i/2),col:this.col,speed:e.rand.range(1,5),dist:100*e.rand.range(3,5)}));t||e.countScore(this.val),e.audio.play("explosion")},e.brick.prototype.hit=function(t,i){this.hitType=i,this.energy-=t,this.energy<=0&&!this.removed&&this.destroy(),e.audio.play("hit")},e.brick.prototype.update=function(){this.y+=e.timer.move+this.add,0===this.add?0!==e.s&&this.y>e.stage.height-this.h-e.brickWidth&&e.over():this.add-=e.gravity},e.brick.prototype.draw=function(){e.ctx.save(),e.ctx.translate(this.x,this.y),e.ctx.drawImage(this.sprite,0,0),e.ctx.restore()}}(),function(){e.star=function(t){this.x=e.rand.flot()*e.bgCtx.canvas.width,this.y=e.rand.flot()*e.bgCtx.canvas.height,this.brightness=15*t+e.rand.range(14*t,18*t)/100,this.radius=e.rand.flot()/t*4,this.color=e.starColors[e.rand.range(0,e.starColors.length)],this.draw()},e.star.prototype.draw=function(){e.bgCtx.save(),e.bgCtx.beginPath(),e.bgCtx.globalAlpha=this.brightness,e.bgCtx.fillStyle=this.color,e.bgCtx.arc(this.x,this.y,this.radius,0,e.PI2),e.bgCtx.fill(),e.bgCtx.closePath(),e.bgCtx.restore()}}(),function(){e.obj.extend(!0,e,{timer:{date:new Date,curr:null,timestamp:Date.now(),delta:1,msec:0,move:0,t:1e3/60,tick:function(){e.timer.curr=Date.now(),e.timer.d=e.timer.curr-e.timer.timestamp,e.timer.delta=e.timer.d/e.timer.t,e.timer.delta=e.timer.delta<0?.001:e.timer.delta,e.timer.delta=e.timer.delta>10?10:e.timer.delta,e.timer.msec+=e.timer.delta,e.timer.timestamp=e.timer.curr,e.timer.move=e.s*e.timer.delta}},emitter:{sum:0,row:0,emit:function(){if(e.emitter.sum>e.brickHeight+e.gap||0===e.emitter.sum){e.emitter.sum=0;for(var t,i,o,r=0,n=e.columns;n>r;r+=1)i=e.rand.select(e.elementTypes),o=e.rand.select(Object.keys(e.elements[i].bricks)),t=new e.brick({column:r,type:i,item:o}),t.row=e.emitter.row,e.bricks[r].unshift(t);e.emitter.row++,e.s+=.001}e.emitter.sum+=e.timer.move}},initBackground:function(){for(var t=null,i=0,o=e.bgs.length;o>i;i+=1){e.bgCtx.clearRect(0,0,e.bgCtx.canvas.width,e.bgCtx.canvas.height);for(var r=0,n=e.starAmount;n>r;r+=1)t=new e.star(e.bgs.length-i+1),t.draw();e.bgs[i].b.style.backgroundImage="url("+e.bg.toDataURL()+")"}},noBg:function(){e.moveBg=!e.moveBg},mute:function(){e.audio.mute=!e.audio.mute},menu:function(t){e.paused=!0,t&&e.bricks&&(e.re.style.display="block"),e.mnu.style.display="block",e.msg.style.display="none"},newgame:function(){e.bricks=e.arr.create(e.columns),e.towers=[],e.bullets=[],e.particles=[],e.explosions=[],e.activeColumn=null,e.hoverColumn=null;var t=e.elementTypes.concat(e.arr.create(e.columns-4,0)).sort(function(){
return.5-Math.random()});e.arr.loop(t,function(i,o){e.towers[o]=t[o]?new e.tower({column:o,type:t[o]}):!1}),e.score=0,e.s=e.speed,e.countScore(0),e.paused=!1,e.msg.style.display="none"},over:function(){var t=600;e.s=0,e.message("GAME OVER",0,"MAIN MENU"),e.audio.play("death"),e.towers.forEach(function(e,t){setTimeout(function(){e&&e.x&&e.destroy()},100*t)}),e.bricks.forEach(function(e){setTimeout(function(){e.forEach(function(e){e&&!e.removed&&(e.add=-.001)})},t),t+=100})},pause:function(){e.paused?(e.paused=!1,e.message()):(e.paused=!0,e.message("PAUSE"))},help:function(){if(!e.buildHelp){for(var t in e.elements)if(e.elements.hasOwnProperty(t)){var i=t,o=e.elements[t],r=e.dom.create("div"),n=e.dom.create("h2"),s=e.dom.create("p"),a=e.dom.create("p");n.innerHTML=i+"<br />",s.innerHTML=o.desc,a.innerHTML=o.spec,r.appendChild(n),s.insertBefore(e.sprite.get(i),s.firstChild),r.appendChild(s),a.insertBefore(e.sprite.get(i+"-BRICK-special"),a.firstChild),r.appendChild(a),e.hlp.appendChild(r)}e.buildHelp=!0}e.message(e.hlp,0,"MAIN MENU")},message:function(t,i,o){var r,n=e.msg.style;e.mnu.style.display="none",t?("object"==typeof t?(e.msg.innerHTML="",t.style.display="block",e.msg.appendChild(t)):e.msg.innerHTML=t,o&&(r=e.dom.create("em"),r.innerHTML=o,e.msg.appendChild(r)),n.opacity=0,n.display="block",n.marginTop=-e.msg.offsetHeight/2+"px",n.opacity=1):n.display="none",i&&setTimeout(function(){n.display="none"},i)},credits:function(){e.message(e.crd,0,"MAIN MENU")},controls:function(){window.addEventListener("keyup",function(t){switch(t.keyCode){case 27:e.menu(!0);break;case 80:e.pause();break;case 77:e.mute();break;case 66:e.noBg()}},!1),e.ng.addEventListener("click",function(){e.newgame(),e.audio.play("click"),e.mnu.style.display="none"},!1),e.hl.addEventListener("click",function(){e.help(),e.audio.play("click")},!1),e.re.addEventListener("click",function(){e.pause()},!1),["hlp","msg","crd"].forEach(function(t){e[t].addEventListener("click",function(){e.menu()},!1)}),e.cr.addEventListener("click",function(){e.credits(),e.audio.play("click")},!1),["ng","hl","cr","re"].forEach(function(t){e[t].addEventListener("mouseover",function(){e.audio.play("hover")},!1)}),e.cnt.addEventListener("mousemove",function(t){if(!e.paused&&e.s>0){var i=t.pageX-this.offsetLeft,o=Math.floor(i/(e.brickWidth+e.gap+e.gap/e.columns));e.hoverColumn=o}else e.hoverColumn=null},!1),e.cnt.addEventListener("click",function(t){if(!e.paused&&e.s>0){var i=t.pageX-this.offsetLeft,o=Math.floor(i/(e.brickWidth+e.gap+e.gap/e.columns));e.towers[o]&&!e.towers[o].removed?null===e.activeColumn?(e.activeColumn=o,e.audio.play("select")):(e.towers[e.activeColumn].setColumn(o),e.towers[o].setColumn(e.activeColumn),e.arr.move(e.towers,e.activeColumn,o),e.activeColumn=null,e.audio.play("move")):(null!==e.activeColumn&&(e.towers[e.activeColumn].setColumn(o),e.arr.move(e.towers,e.activeColumn,o),e.audio.play("move")),e.activeColumn=null)}else e.activeColumn=null},!1)},stats:function(){var t;"function"==typeof Stats?(t=new Stats,t.setMode(0),t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",document.body.appendChild(t.domElement),e.stats=t):e.stats={begin:e.noop,end:e.noop}},countScore:function(t){e.score+=t,e.level=Math.ceil(e.s/.12),e.hud.score.innerHTML=e.score,e.hud.level.innerHTML=e.level,e.level>e.prevLevel&&(e.prevLevel=e.level,e.message("LEVEL UP",2e3),e.audio.play("levelup"))},update:function(){e.arr.loop(e.bricks,function(t,i){e.arr.loop(t,function(e,i){e&&(e.removed?t.splice(i,1):e.update())})}),e.arr.loop([e.towers,e.bullets,e.particles,e.explosions],function(t){e.arr.loop(t,function(e,i){e&&(e.removed?t.splice(i,1):e.update())})}),e.rumble.update()},updateBackground:function(){if(e.moveBg)for(var t=0,i=e.bgs.length;i>t;t+=1)e.bgs[t].c+=t+1,e.bgs[t].b.style.backgroundPosition="0px "+e.bgs[t].c/3+"px"},rumble:{update:function(){e.rumble.level>0?(e.rumble.level-=e.rumble.decay,e.rumble.level=e.rumble.level<0?0:e.rumble.level,e.rumble.x=e.rand.rangef(-e.rumble.level,e.rumble.level),e.rumble.y=e.rand.rangef(-e.rumble.level,e.rumble.level)):(e.rumble.x=0,e.rumble.y=0)},draw:function(){(0!==e.rumble.x||0!==e.rumble.y)&&(e.stage.style[e.transformName]="translate("+e.rumble.x+"px,"+e.rumble.y+"px)")}},draw:function(){e.ctx.save(),e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),e.arr.loop(e.bricks,function(t){e.arr.loop(t,function(e){e&&!e.removed&&e.draw()})}),e.arr.loop([e.towers,e.bullets,e.particles,e.explosions],function(t){e.arr.loop(t,function(e){e&&!e.removed&&e.draw()})}),e.drawFlash(),e.rumble.draw(),e.drawSelection()},drawSelection:function(){var t,i;if(null!==e.activeColumn&&(t=e.towers[e.activeColumn],t&&t.x&&(e.ctx.save(),e.ctx.translate(t.x,0),e.ctx.lineWidth=2,e.ctx.fillStyle=e.elements[t.type].color,e.ctx.globalAlpha=.2,e.ctx.fillRect(0,0,e.brickWidth,e.stage.height),e.ctx.restore())),null!==e.hoverColumn){t=e.towers[e.activeColumn],i=e.towers[e.hoverColumn];var o="#ffffff";i&&i.x&&(o=e.elements[i.type].color),t&&t.x&&(o=e.elements[t.type].color),e.ctx.save(),e.ctx.translate(e.gap+e.hoverColumn*(e.brickWidth+e.gap),0),e.ctx.lineWidth=2,e.ctx.fillStyle=o,e.ctx.globalAlpha=.2,e.ctx.fillRect(0,0,e.brickWidth,e.stage.height),e.ctx.restore()}},drawFlash:function(){e.flash>0&&(e.flash--,e.f.style.opacity=e.flash/10)},init:function(){e.obj.extend(!0,e,{ww:window.innerWidth,wh:window.innerHeight,rumble:{body:e.dom.get("r")},hud:{level:e.dom.get("lv"),score:e.dom.get("sc")},cnt:e.dom.get("cnt"),msg:e.dom.get("msg"),mnu:e.dom.get("mnu"),hlp:e.dom.get("hlp"),crd:e.dom.get("crd"),re:e.dom.get("re"),ng:e.dom.get("ng"),hl:e.dom.get("hl"),cr:e.dom.get("cr"),f:e.dom.get("f"),stage:e.dom.get("c"),bg:e.dom.get("b"),bgs:[{b:e.dom.get("b1"),c:0},{b:e.dom.get("b2"),c:0},{b:e.dom.get("b3"),c:0}]}),e.stage.width=e.wh/2,e.stage.height=e.wh-30,e.cnt.style.width=e.stage.width+"px",e.cnt.style.height=e.wh+"px",e.bg.width=e.ww,e.bg.height=e.wh,e.brickWidth=e.stage.width/e.columns-e.gap-e.gap/e.columns,e.brickHeight=e.brickWidth/2+e.gap,e.obj.extend(!0,e,{ctx:e.stage.getContext("2d"),bgCtx:e.bg.getContext("2d"),elementTypes:Object.keys(e.elements),transformName:e.vendor.get("transform"),prevLevel:0,score:0,flash:0,paused:!0});for(var i=0;3>i;i++)e.bgs[i].width=e.ww,e.bgs[i].height=e.wh;e.sprite.factory(),e.initBackground(),e.controls(),e.stats(),e.menu();var o=new AudioContext,r=new t.MusicGenerator(song);r.createAudioBuffer(function(e){var t=o.createBufferSource();t.buffer=e,t.connect(o.destination),t.start()})}}),e.init(),function i(){requestAnimationFrame(i,e.stage.canvas),e.timer.tick(),e.stats.begin(),e.updateBackground(),e.paused||(e.emitter.emit(),e.update(),e.draw()),e.stats.end()}()}()}();